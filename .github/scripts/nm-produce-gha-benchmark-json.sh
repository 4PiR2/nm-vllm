#!/bin/bash
# GHA uses this script to run the neuralmagic-vllm/neuralmagic/benchmarks/scripts/logging/gha_benchmark_logging.py
# tool that processes the JSONs generated by the benchmarking scripts and outputs JSONs that can be
# consumed by the github-benchmarking-action

set -e
set -u
  
if [ $# -ne 2 ];
then
  echo "nm-produce-gha-benchmark-json.sh needs exactly 3 arguments"
  echo "run_benchmarks needs exactly 3 arguments: "
  echo " 1. Path to a directory containing a list of BenchmarkResult JSONs"
  echo " 2. Path to a file where the GHA CustomBiggerIsBetter JSON is to be stored"
  echo " 3. Path to a file where the GHA CustomSmallerIsBetter JSON is to be stored"
  exit 1
fi
  
benchmark_directory
benchmark_config_list_file=$1
output_directory=$2
  
for bench_config in `cat $benchmark_config_list_file`
do
  echo "Running benchmarks for config " $bench_config
  python3 -m neuralmagic.benchmarks.run_benchmarks -i $bench_config -o $output_directory
done
